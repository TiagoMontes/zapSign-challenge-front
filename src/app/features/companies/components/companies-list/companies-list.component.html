<div class="companies-list-container">
  <!-- Header Section -->
  <div class="header-section">
    <div class="title-container">
      <h1 class="page-title">
        
        Companies Management
      </h1>
      <p class="page-subtitle">
        Manage your companies and their API integrations
      </p>
    </div>

    <div class="header-actions">
      <button
        mat-flat-button
        color="primary"
        (click)="onCreateCompany()"
        class="create-btn">
        
        Create Company
      </button>

      <button
        mat-button
        matTooltip="Refresh"
        (click)="onRefresh()"
        [disabled]="loading()">
        
      </button>
    </div>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-section">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search companies</mat-label>
      <input
        matInput
        [formControl]="searchControl"
        placeholder="Search by name or API token..."
        autocomplete="off">
      
      <button
        mat-button
        matSuffix
        *ngIf="searchControl.value"
        (click)="onClearSearch()"
        matTooltip="Clear search">
        
      </button>
    </mat-form-field>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading companies...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error()" class="error-container">
    
    <p>{{ error() }}</p>
    <button mat-stroked-button color="primary" (click)="onRefresh()">
      
      Try Again
    </button>
  </div>

  <!-- Empty State - No Companies -->
  <div *ngIf="!loading() && !error() && !hasCompanies()" class="empty-state">
    
    <h2>No Companies Yet</h2>
    <p>Create your first company to get started with document management.</p>
    <button
      mat-flat-button
      color="primary"
      (click)="onCreateCompany()">
      
      Create First Company
    </button>
  </div>

  <!-- No Search Results -->
  <div *ngIf="!loading() && !error() && showNoResults()" class="no-results">
    
    <h3>No Results Found</h3>
    <p>No companies match your search criteria: "{{ searchControl.value }}"</p>
    <button mat-stroked-button (click)="onClearSearch()">
      Clear Search
    </button>
  </div>

  <!-- Companies Table -->
  <div *ngIf="!loading() && !error() && hasFilteredResults()" class="table-container">
    <mat-table
      [dataSource]="filteredCompanies()"
      class="companies-table">

      <!-- Company Name Column -->
      <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef class="name-header">
          Company Name
        </mat-header-cell>
        <mat-cell *matCellDef="let company" class="name-cell">
          <div class="company-info">
            <div class="company-name">{{ company.name }}</div>
            <div class="company-id">ID: {{ company.id }}</div>
          </div>
        </mat-cell>
      </ng-container>

      <!-- API Token Column -->
      <ng-container matColumnDef="api_token">
        <mat-header-cell *matHeaderCellDef class="token-header">
          API Token
        </mat-header-cell>
        <mat-cell *matCellDef="let company" class="token-cell">
          <div class="token-container">
            <code class="token-display">{{ getTruncatedToken(company.api_token) }}</code>
            <button
              mat-button
              matTooltip="Copy full token"
              (click)="$event.stopPropagation()"
              class="copy-btn">
              
            </button>
          </div>
        </mat-cell>
      </ng-container>

      <!-- Created Date Column -->
      <ng-container matColumnDef="created_at">
        <mat-header-cell *matHeaderCellDef class="date-header">
          Created
        </mat-header-cell>
        <mat-cell *matCellDef="let company" class="date-cell">
          <div class="date-info">
            <div class="date-primary">{{ formatDate(company.created_at) }}</div>
            <div class="date-secondary" *ngIf="company.last_updated_at !== company.created_at">
              Updated: {{ formatDate(company.last_updated_at) }}
            </div>
          </div>
        </mat-cell>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef class="actions-header">
          Actions
        </mat-header-cell>
        <mat-cell *matCellDef="let company" class="actions-cell">
          <div class="action-buttons">
            <button
              mat-button
              matTooltip="View Details"
              (click)="onViewCompany(company); $event.stopPropagation()"
              class="action-btn view-btn">
              
            </button>

            <button
              mat-button
              matTooltip="View Documents"
              (click)="onViewDocuments(company); $event.stopPropagation()"
              class="action-btn documents-btn">
              
            </button>

            <button
              mat-button
              matTooltip="Edit Company"
              (click)="onEditCompany(company); $event.stopPropagation()"
              class="action-btn edit-btn">
              
            </button>

            <button
              mat-button
              matTooltip="Delete Company"
              (click)="onDeleteCompany(company); $event.stopPropagation()"
              class="action-btn delete-btn"
              color="warn">
              
            </button>
          </div>
        </mat-cell>
      </ng-container>

      <!-- Table Header and Rows -->
      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row
        *matRowDef="let company; columns: displayedColumns;"
        (click)="onViewCompany(company)"
        class="company-row">
      </mat-row>
    </mat-table>
  </div>

  <!-- Results Summary -->
  <div *ngIf="!loading() && !error() && hasFilteredResults()" class="results-summary">
    <span class="results-count">
      Showing {{ filteredCompanies().length }} of {{ companies().length }} companies
    </span>
    <span *ngIf="searchControl.value" class="search-info">
      for "{{ searchControl.value }}"
    </span>
  </div>
</div>